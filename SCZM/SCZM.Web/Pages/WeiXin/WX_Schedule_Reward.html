<!doctype html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover" />
    <title>我的收入</title>
    <link rel="stylesheet" href="../../css/WebUi/weui.min.css" />
    <link rel="stylesheet" href="../../css/WebUi/example.css" />
    <script type="text/javascript" src="../../css/WebUi/zepto.min.js"></script>
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
    <script type="text/javascript" src="../../scripts/jquery-easyui-1.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <link href="../../css/WebUi/iosSelect.css" rel="stylesheet" />
    <script src="../../css/WebUi/iosSelect.js"></script>
    <style type="text/css">
        .procedure {
            display:inline-block;
            width:79%;
        }

        .title {
            font-size: 12px;
            /*font-size: 18px;*/
            /*border-bottom: 1px solid gray;*/
            display: inline-block;
            width: 30%;
            vertical-align: top;
            line-height: 16px;
        }

        .nat {
            display:inline-block;
            /*font-size: 20px;*/
            width: 20%;
        }

        .information {
            color: #808080;
            font-size: 12px;
        }

        .scroll {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
            overflow-y: auto;
        }

        .hide {
            display: none;
        }

        .show {
            opacity: 0.8;
            background-color: #c4c4c4;
        }

        .weui-cells::after {
            border: 0;
        }

        .content_50 {
            display: inline-block;
            width: 50%;
        }

        .content_25 {
            font-size: 12px;
            display: inline-block;
            width: 25%;
            vertical-align: top;
            line-height: 16px;
            text-align: center;
        }

        .vertical {
            vertical-align: top;
        }

        .detail::before {
            border-top: 0;
        }

        .title_l {
            float: left;
        }

        .title_r {
            float: right;
        }

        .weui-cell__bd input {
            text-align: right;
        }

        input[type="date"] {
            border-bottom: 1px solid gray;
        }

            input[type="date"].full:before {
                color: black;
                content: ""!important;
            }

        .weui-dialog__bd:first-child {
            padding-top: 2px;
        }

        .weui-input {
            border-radius: 0;
        }

        body {
            background-color: #eeebeb;
        }

        .main .WM {
            text-align: center;
            margin-top: 10px;
        }

            .main .WM > span {
                display: inline-block;
                width: 45%;
                height: 40px;
                text-align: center;
                line-height: 36px;
                font-size: 24px;
                background-color: white;
                opacity: 0.7;
            }

        .main .selected {
            background-color: gray !important;
        }

        hr {
            margin-top: 5px;
        }

        .page__bd .weui-cell__bd {
            background-color: white;
            height: 36px;
            border: 1px solid gray;
            margin: 0 2px;
            border-radius: 4px;
            line-height: 35px;
        }

        .main .statistics > div {
            display: inline-block;
            font-size: 36px;
            text-align: center;
            width: 50%;
            height: 120px;
            background-color: #346da0;
            box-sizing: border-box;
        }

            .main .statistics > div:nth-child(1) {
                border-right: 1px solid white;
            }
            .weui-dialog {
            max-width:none;
            width:95%;
            height:90%;
        }
        .weui-dialog__bd {
            padding:0;
            overflow-y:auto;
            height:90%;
        }
        #iosDialog3 .modelCode>div span{
                font-size:16px;
                font-weight:bold;
                line-height:50px;
                height:50px;
                border-bottom:1px solid rgba(174, 174, 174, 0.8);
        }
        .weui-cells.main .main span{
                font-size:16px;
                font-weight:bold;
                line-height:50px;
                height:50px;
                width:50%;
                text-align:center;
                border-bottom:1px solid rgba(174, 174, 174, 0.8);
        }
        .weui-cells.main .detail span{
                font-size:14px;
                /*font-weight:bold;*/
                line-height:30px;
                height:30px;
                width:40%;
                text-align:left;
                margin-left:10px;
        }
        .weui-cells.main .detail {
            border-bottom:1px solid rgba(174, 174, 174, 0.8);
        }
        .weui-picker__group:nth-child(3) {
            display:none !important;
        }
                .weui-dialog__btn_default {
            float:right;
        }
            .weui-dialog__btn_default::after {
                border-left:0;
            }
        .search {
            
        }
            .search img {
                
            }
    </style>
</head>
<body ontouchstart>
    <div class="container" id="container">
        <div id="loadingToast" style="display: none">
            <div class="weui-mask_transparent"></div>
            <div class="weui-toast">
                <i class="weui-loading weui-icon_toast"></i>
                <p class="weui-toast__content">数据加载中</p>
            </div>
        </div>
        <div class="page__bd" style="height: 100%">
            <div class="main">
                <div class="weui-tab">
                    <div class="weui-navbar">
                        <span class="weui-navbar__item selected" data-name="w">
                            本周收入
                        </span>
                        <span class="weui-navbar__item" data-name="m">
                            本月收入
                        </span>
                        <span class="weui-navbar__item" data-name="part">
                            历史
                        </span>
                    </div>
                    <div class="weui-tab__panel">
                        <!--<div class="WM"><span class="selected" data-name="w">本周收入</span><span data-name="m">本月收入</span></div>-->
                        <hr />
                        <div class="weui-cell Spart hide">
                            <div class="weui-cell__bd">
                                <!--<input class="weui-input" id="txtScheduleDate_Start" type="date" style="direction: ltr; font-size: 18px;" value="" />-->
                                <!--<a href="javascript:;" class="weui-btn weui-btn_default" id="txtScheduleDate_Start" style="height:36px;" >&nbsp;</a>-->
                                <div class="form-item item-line" id="SelectDate_Start">                                 
    <div class="pc-box" style="text-align:center">                     
        <span data-year="" data-month="" data-date="" id="txtScheduleDate_Start">开始时间</span>  
    </div>             
</div>
                            </div>
                            ———
                        <div class="weui-cell__bd">
                            <!--<input class="weui-input" id="txtScheduleDate_End" type="date" style="direction: ltr; font-size: 18px;" value="" />-->
                            <!--<a href="javascript:;" class="weui-btn weui-btn_default" id="txtScheduleDate_End" style="height:36px">&nbsp;</a>-->
                            <div class="form-item item-line" id="SelectDate_End">                                 
    <div class="pc-box" style="text-align:center">                     
        <span data-year="" data-month="" data-date="" id="txtScheduleDate_End">截止时间</span>  
    </div>             
</div>
                        </div>
                        <div class="weui-cell__ft" style="height:38px">
                            <div class="weui-btn weui-btn_default weui-btn_mini search" style="background-image:url('../../Images/search%20(1).png');background-position:50% 50%;width:38px;height:38px" onclick="getData()"></div>
                        </div>
                        </div>
                        <div class="statistics">
                            <div>
                                <span class="num">0</span><br />
                                <span>工单数</span>
                            </div><!--
                            --><div>
                                <span class="reward">￥0</span><br />
                                <span>收益</span>
                            </div>
                        </div>
<div class="form-item item-line" id="selectDate" style="display:none">                                 
    <div class="pc-box">                     
        <span data-year="" data-month="" data-date="" id="showDate">点击这里选择时间</span>  
    </div>             
</div>
                    
                </div>
                </div>
            </div>
        </div>
    </div>
    <div id="dialogs">
        
        <div class="js_dialog" id="iosDialog4" style="opacity: 1; display: none;">
            <div class="weui-mask"></div>

            <div class="weui-dialog">
                <div class="weui-dialog__title"></div>
                <div class="weui-dialog__bd">
                    <div class="weui-cells__title"><span style="font-size:larger;font-weight:bold">工单统计</span><a class="weui-dialog__btn weui-dialog__btn_default" style="color: gray">返回</a></div>
                    <div class='weui-cells num'>
                    </div>
                </div>

            </div>
        </div>
        <div class="js_dialog" id="iosDialog3" style="opacity: 1; display: none;">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div class="weui-dialog__title"></div>
                <div class="weui-dialog__bd">
                     <div class="weui-cells__title"><span style="font-size:larger;font-weight:bold">工单统计</span><a class="weui-dialog__btn weui-dialog__btn_default" style="color: gray">返回</a></div>
                    <div class='weui-cells modelCode'>
                                <div><span class='title'>机型</span><span class='title'>机号</span><span class='title'>收入</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="js_dialog" id="iosDialog5" style="opacity: 1; display: none;">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div class="weui-dialog__title"></div>
                <div class="weui-dialog__bd">
                     <div class="weui-cells__title"><span class="main_t" style="font-size:larger;font-weight:bold"></span><a class="weui-dialog__btn weui-dialog__btn_default" style="color: gray">返回</a></div>
                    <div class='weui-cells scroll main'>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript">
        
        $(document).ready(function () {
            $('.statistics .reward').on('click', function () {
                $('#iosDialog3').fadeIn(200);
            });
            $('.statistics .num').on('click', function () {
                $('#iosDialog4').fadeIn(200);
            });
            $('.weui-dialog__btn_default').empty().append('<img src="../../Images/close.png" />');
            if (location.search.length > 0) {
                var query = location.search;
                $.each(query.substr(1).split('&'), function (k, v) {
                    if (v.split('=')[0] == "code") {

                        var code = v.split('=')[1];
                        $.ajax({
                            type: 'get',
                            dataType: 'json',
                            data: { "action": "GetUserId", "code": code, "name": "scheduleReward" },
                            url: "../../Ashx/WX/WX_GetLoginInfo.ashx",
                            success: function (data, status, xhr) {
                                if (data.state == "1") {
                                    //$('.WM span').on("click", function () {
                                    try {
                                        //alert(1);
                                        $('.weui-navbar span').on("click", function () {
                                            $(this).addClass('selected').siblings().removeClass('selected');
                                            if (this.dataset.name != "part") {
                                                $('.Spart').addClass('hide');
                                                getRepairReward({ "action": "GetRepairReward", "person": "repairer", "type": this.dataset.name })
                                            } else {
                                                $('.Spart').removeClass('hide');
                                            }
                                        });

                                    } catch (e) {
                                        alert(e.message);
                                    }
                                    
                                    //$('#txtScheduleDate_Start,#txtScheduleDate_End').on('click', function () {
                                    //    var self = this;
                                    //    weui.datePicker({
                                    //        start: 1990,
                                    //        end: new Date().getFullYear(),
                                    //        onConfirm: function (result) {
                                    //            $(self).empty().append(result[0] + '-' + result[1]);

                                    //            var ScheduleDate_Start = $('#txtScheduleDate_Start').text();
                                    //            var ScheduleDate_End = $('#txtScheduleDate_End').text();
                                    //            var middle = "";
                                    //            if (trim(ScheduleDate_Start) != "" && trim(ScheduleDate_End) != "" && new Date((ScheduleDate_Start + '-1').replace(/\-/g, '\/')) > new Date((ScheduleDate_End + '-1').replace(/\-/g, '\/'))) {
                                    //                $('#txtScheduleDate_Start').text(ScheduleDate_End);
                                    //                $('#txtScheduleDate_End').text(ScheduleDate_Start);
                                    //                middle = ScheduleDate_Start;
                                    //                ScheduleDate_Start = ScheduleDate_End;
                                    //                ScheduleDate_End = middle;
                                    //            }
                                    //            getRepairReward({ "action": "GetRepairReward", "person": "repairer", "ScheduleDate_Start": ScheduleDate_Start, "ScheduleDate_End": ScheduleDate_End, "type": "" })
                                    //        }
                                    //    });
                                    //});
                                    
                                    //$('#txtScheduleDate_Start,#txtScheduleDate_End').on('change', function () {
                                       
                                    //});
                                    getRepairReward({ "action": "GetRepairReward", "person": "repairer", "type": "w" });

                                } else {
                                    alert(data.msg);
                                }
                            },
                            error: function (xhr, status, errorThrown) {
                                alert(errorThrown);
                            }
                        });
                    } else {
                    }
                });
            } else {
                alert(1);
            }
        });

        function getRepairReward(data) {
            var selectType = data.type;
            $('#loadingToast').fadeIn(100);
            $.ajax({
                type: "post",
                url: "../../Ashx/WX/WX_GetLoginInfo.ashx",
                dataType: "json",
                data: data,
                success: function (data, status, xhr) {
                    if (data.status == "1") {
                        var nat = 0, detailRow = "", UnAudit = 0, History = 0;
                        $('.weui-cells.main').empty();
                        $('.modelCode>div:not(:first-child)').empty()
                        var modelcode = new Array();
                        for (var i = 0, len = data.info.length; i < len; i++) {
                            var rowData = formatRepairerReward("", data.info[i], i);
                            if (rowData["AllNat_Audit"] == "1") { UnAudit++; }
                            else if (rowData["AllNat_Audit"] == "") {
                                History++;
                            }
                            nat = accAdd(nat, rowData["Nat"]);
                            ////
                            //var row = "<div class='weui-cell main'><div class='weui-cell__bd'><p style='text-align:left;' data-id='" + rowData["AssignmentProcedureId"] + "' onclick='showDetail(this)' >";
                            //row += "<span class='title'>" + rowData["MachineModel"] + "/" + rowData["MachineCode"] + "</span><span class='procedure title'>" + rowData["ProcedureName"] + "</span><span class='nat'>" + (rowData["Nat"] == "" ? "0" :(rowData["Nat"] == "1"?'待审核':rowData["Nat"])) + "</span>";

                            //row += "</p></div></div>";
                            ////---------------------------------------------
                            //row += '<div class="weui-cell detail hide"><div class="weui-cell__bd"><p style="text-align:left"><span class="information">' + rowData["CustName"] + '</span><br /><span class="content_50 information">维修总奖励：' + (rowData["AllNat_Audit"] == "" ? "未设定" : parseFloat(rowData["AllNat_Audit"])) + '</span><span class="content_50 information">系数：' + (rowData["Assess"] == "" ? "未设定" : parseFloat(rowData["Assess"])) + '/' + (rowData["PersonsAssess"] == "" ? "未设定" : parseFloat(rowData["PersonsAssess"])) + '</span><br/><span class="information">工作内容：' + rowData["RepairContent"] + '</span><br/><span class="information">完工时间：' + rowData["ScheduleDate"] + '</span></p></div></div>';
                            ////----------------------------------------------
                            //$('.weui-cells.main').append(row);
                            ////
                            if (modelcode.indexOf(rowData["MachineCode"]) == -1) {
                                modelcode.push(rowData["MachineCode"]);
                                $('.modelCode').append("<div data-code='" + rowData["MachineCode"] + "'><span class='title'>" + rowData["MachineModel"] + "</span><span class='title'>" + rowData["MachineCode"] + "</span><span class='title'>" + (rowData["Nat"] == "" ? "0" :rowData["Nat"]) + "</span></div>");
                            } else {
                                var natDom = $(".modelCode div[data-code='" + rowData["MachineCode"] + "'] span:nth-child(3)");
                                var addNat=rowData["Nat"] == "" ? "0" : rowData["Nat"];
                                natDom.text(natDom.text() * 1 + addNat * 1);
                            }
                        }
                        $('.statistics .reward').empty().append('￥' + nat);
                        $('.statistics .num').empty().append(data.info.length);
                        //alert(data.info.length);
                        $('#iosDialog4 .num').empty().append("<p style='text-align:left'><span class='content_25'>总工单数</span><span class='content_25'>收益工单数</span><span class='content_25'>待审核</span><span class='content_25'>历史记录</span><br/><span class='content_25'>" + (data.info.length) + "</span><span class='content_25'>" + (data.info.length - UnAudit - History) + "</span><span class='content_25'>" + UnAudit + "</span><span class='content_25'>" + History + "</span></p>")
                        if (selectType != "" && data.timepart != []) {
                            //alert(data.timepart[0].s);
                            $('#txtScheduleDate_Start').text(new Date(data.timepart[0].s).format('yyyy-M'));
                            $('#txtScheduleDate_End').text(new Date(data.timepart[0].e).format('yyyy-M'));
                        }
                        $('.modelCode>div:not(:first-child)').on('click', function () {
                            $('#loadingToast').fadeIn(100);
                            var selectCode = this.dataset.code;
                            $('.weui-cells.main').empty();
                            for (var i = 0, len = data.info.length; i < len; i++) {
                                var rowData = formatRepairerReward("", data.info[i], i);
                                if (rowData["MachineCode"] == selectCode) {
                                    var row = "<div class='weui-cell main'><div class='weui-cell__bd'><p style='text-align:left;' data-id='" + rowData["AssignmentProcedureId"] + "' onclick='showDetail(this)' >";
                                    row += "<span class='procedure title'>" + rowData["ProcedureName"] + "</span><span class='nat'>" + (rowData["Nat"] == "" ? "0" : (rowData["Nat"] == "1" ? '待审核' : rowData["Nat"])) + "</span>";
                                    //row += "<span>机型：" + rowData["MachineModel"] + "</span><span>机号：" + rowData["MachineCode"] + "</span>";
                                    row += "</p></div></div>";
                                    //---------------------------------------------
                                    row += '<div class="weui-cell detail hide"><div class="weui-cell__bd"><p style="text-align:left"><span class="information">' + rowData["CustName"] + '</span><br /><span class="content_50 information">维修总奖励：' + (rowData["AllNat_Audit"] == "" ? "未设定" : parseFloat(rowData["AllNat_Audit"])) + '</span><span class="content_50 information">系数：' + (rowData["Assess"] == "" ? "未设定" : parseFloat(rowData["Assess"])) + '/' + (rowData["PersonsAssess"] == "" ? "未设定" : parseFloat(rowData["PersonsAssess"])) + '</span><br/><span class="information">工作内容：' + rowData["RepairContent"] + '</span><br/><span class="information">完工时间：' + rowData["ScheduleDate"] + '</span></p></div></div>';
                                    //----------------------------------------------
                                    $('.weui-cells.main').append(row);
                                }
                            }
                            
                            $('#loadingToast').fadeOut(100);
                            $('#iosDialog5 .main_t').empty().append(selectCode);
                            
                            $('#iosDialog5').fadeIn(100);
                        });
                        $('#loadingToast').fadeOut(100);
                    }
                },
                error: function (xhr, status, errorThrown) {

                }
            });
        }
        function showDetail(obj) {
            var $main = $(obj).parents('.weui-cell.main');
            if (!$main.hasClass("show")) {
                $main.addClass("show");
            } else {
                $main.removeClass("show");
            }
            var $detail = $main.next();
            if ($detail.hasClass("hide")) {
                $detail.removeClass("hide");
            } else {
                $detail.addClass("hide");
            }
        }
        function formatRepairerReward(value, rowData, rowIndex) {
            rowData["Nat"] = rowData["AllNat_Audit"] == "" ? "" : formatNum(accDiv(accMul(rowData["AllNat_Audit"], rowData["Assess"]), rowData["PersonsAssess"]), 2)
            rowData["AllNat_Assignment"] == "" ? rowData["AllNat"] == "" ? "" : formatNum(accMul(rowData["Num"], rowData["AllNat"]), 2) : formatNum(rowData["AllNat_Assignment"], 2);
            var formatValue = "", AuditStateStr = "";
            switch (rowData["AuditState"]) {
                case "":
                case "0":
                    formatValue = "待审核";
                    rowData["Nat"] = "待审核";
                    break;
                case "1":
                    formatValue = formatNum(value, 2);
                    break;
                case "2":
                    formatValue = "审核不同意";
                    rowData["Nat"] = "审核不同意";
                    break;
                default:
            }
            rowData["AuditStateStr"] = formatValue;
            return rowData;
        }
        $('.calendar').off('click');
        $('.calendar').on('click', function () {
            $('#iosDialog5').fadeIn(200);
        });

        $('#iosDialog5').off('click', '.weui-dialog__btn_primary');
        $('#iosDialog5').on('click', '.weui-dialog__btn_primary', function () {
            $(this).parents('#iosDialog5').fadeOut(200);
            var ScheduleDate_Start = $('#txtScheduleDate_Start').val();
            var ScheduleDate_End = $('#txtScheduleDate_End').val();
            var middle = "";
            if (ScheduleDate_Start != "" && ScheduleDate_End != "" && new Date(ScheduleDate_Start.replace(/\-/g, '\/')) > new Date(ScheduleDate_End.replace(/\-/g, '\/'))) {
                $('#txtScheduleDate_Start').val(ScheduleDate_End);
                $('#txtScheduleDate_End').val(ScheduleDate_Start);
                middle = ScheduleDate_Start;
                ScheduleDate_Start = ScheduleDate_End;
                ScheduleDate_End = middle;
            }
            getRepairReward({ "action": "GetRepairReward", "person": "repairer", "ScheduleDate_Start": ScheduleDate_Start, "ScheduleDate_End": ScheduleDate_End })
            $('#iosDialog5').fadeOut(200);
        });
        $('#iosDialog3').off('click', '.weui-dialog__btn_default');
        $('#iosDialog3').on('click', '.weui-dialog__btn_default', function () {
            $(this).parents('#iosDialog3').fadeOut(200);
        });
        $('#iosDialog4').off('click', '.weui-dialog__btn_default');
        $('#iosDialog4').on('click', '.weui-dialog__btn_default', function () {
            $(this).parents('#iosDialog4').fadeOut(200);
        });
        $('#iosDialog5').off('click', '.weui-dialog__btn_default');
        $('#iosDialog5').on('click', '.weui-dialog__btn_default', function () {
            $(this).parents('#iosDialog5').fadeOut(200);
        });
        $('#SelectDate_End').on('click', function () {
            selectDateDom = $(this);
            showDateDom = $('#txtScheduleDate_End');
            var oneLevelId = showDateDom.attr('data-year');
            var twoLevelId = showDateDom.attr('data-month');
            var iosSelect = new IosSelect(2,
                [yearData, monthData],
                {
                    title: '地址选择',
                    itemHeight: 35,
                    oneLevelId: oneLevelId,
                    twoLevelId: twoLevelId,
                    showLoading: true,
                    callback: function (selectOneObj, selectTwoObj, selectThreeObj) {
                        showDateDom.attr('data-year', selectOneObj.id);
                        showDateDom.attr('data-month', selectTwoObj.id);
                        showDateDom.html(selectOneObj.id + '-' + selectTwoObj.id);
                        //getData();
                    }
                });
            
        });
        $('#SelectDate_Start').on('click', function () {
            selectDateDom = $(this);
            showDateDom = $('#txtScheduleDate_Start');
            var oneLevelId = showDateDom.attr('data-year');
            var twoLevelId = showDateDom.attr('data-month');
            var iosSelect = new IosSelect(2,
                [yearData, monthData],
                {
                    title: '时间选择',
                    itemHeight: 35,
                    oneLevelId: oneLevelId,
                    twoLevelId: twoLevelId,
                    showLoading: true,
                    callback: function (selectOneObj, selectTwoObj, selectThreeObj) {
                        showDateDom.attr('data-year', selectOneObj.id);
                        showDateDom.attr('data-month', selectTwoObj.id);
                        showDateDom.html(selectOneObj.id + '-' + selectTwoObj.id);
                        //getData();
                    }
                });
           
        });
        function getData() {
                        var ScheduleDate_Start = $('#txtScheduleDate_Start').text();
                        var ScheduleDate_End = $('#txtScheduleDate_End').text();
                        var middle = "";
                        if (trim(ScheduleDate_Start) != "" && trim(ScheduleDate_End) != "" && new Date((ScheduleDate_Start + '-1').replace(/\-/g, '\/')) > new Date((ScheduleDate_End + '-1').replace(/\-/g, '\/'))) {
                            $('#txtScheduleDate_Start').text(ScheduleDate_End);
                            $('#txtScheduleDate_End').text(ScheduleDate_Start);
                            middle = ScheduleDate_Start;
                            ScheduleDate_Start = ScheduleDate_End;
                            ScheduleDate_End = middle;
                        }
                        getRepairReward({ "action": "GetRepairReward", "person": "repairer", "ScheduleDate_Start": ScheduleDate_Start, "ScheduleDate_End": ScheduleDate_End, "type": "" })
        }
    </script>
    <script type="text/javascript">
        var selectDateDom = $('#selectDate');
        var showDateDom = $('#showDate');
        
        // 初始化时间
        var now = new Date();
        var nowYear = now.getFullYear();
        var nowMonth = now.getMonth() + 1;
        showDateDom.attr('data-year', nowYear);
        showDateDom.attr('data-month', nowMonth);
        // 数据初始化
        function formatYear(nowYear) {
            var arr = [];
            for (var i = nowYear - 5; i <= nowYear + 5; i++) {
                arr.push({
                    id: i + '',
                    value: i + '年'
                });
            }
            return arr;
        }
        function formatMonth() {
            var arr = [];
            for (var i = 1; i <= 12; i++) {
                arr.push({
                    id: i + '',
                    value: i + '月'
                });
            }
            return arr;
        }

        var yearData = function (callback) {
            // settimeout只是模拟异步请求，真实情况可以去掉
            // setTimeout(function() {
            callback(formatYear(nowYear))
            // }, 2000)
        }
        var monthData = function (year, callback) {
            // settimeout只是模拟异步请求，真实情况可以去掉
            // setTimeout(function() {
            callback(formatMonth());
            // }, 2000);
        };
        var dateData = function (year, month, callback) {
            // settimeout只是模拟异步请求，真实情况可以去掉
            // setTimeout(function() {
            if (/^(1|3|5|7|8|10|12)$/.test(month)) {
                callback(formatDate(31));
            }
            else if (/^(4|6|9|11)$/.test(month)) {
                callback(formatDate(30));
            }
            else if (/^2$/.test(month)) {
                if (year % 4 === 0 && year % 100 !== 0 || year % 400 === 0) {
                    callback(formatDate(29));
                }
                else {
                    callback(formatDate(28));
                }
            }
            else {
                throw new Error('month is illegal');
            }
            // }, 2000);
            // ajax请求可以这样写
            /*
            $.ajax({
                type: 'get',
                url: '/example',
                success: function(data) {
                    callback(data);
                }
            });
            */
        };
        selectDateDom.bind('click', function () {
            var oneLevelId = showDateDom.attr('data-year');
            var twoLevelId = showDateDom.attr('data-month');
            var iosSelect = new IosSelect(2,
                [yearData, monthData],
                {
                    title: '地址选择',
                    itemHeight: 35,
                    oneLevelId: oneLevelId,
                    twoLevelId: twoLevelId,
                    showLoading: true,
                    callback: function (selectOneObj, selectTwoObj, selectThreeObj) {
                        showDateDom.attr('data-year', selectOneObj.id);
                        showDateDom.attr('data-month', selectTwoObj.id);
                        showDateDom.html(selectOneObj.id + '-' + selectTwoObj.id);
                    }
                });
        });
</script>
     <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
</body>
</html>
